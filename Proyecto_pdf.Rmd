---
title: "Descripción de la Base de Datos ENPOL 2021 a Travez del Análisis de Componentes Principales"
subtitle: "Universidad Nacional de Colombia"
author:

  - "Yudy Vanesa Puerres Rosero (ypuerresr@unal.edu.co)"
  - "Camila Andrea Ayala Camargo (caayala@unal.edu.co)"
  - "Karen Liliana Barrantes Quiroga (kbarrantes@unal.edu.co)"
  - "Laura Katherine Martínez Castiblanco (laumartinezca@unal.edu.co)"
  - "Fredy Arley Urrea Cifuentes (furreac@unal.edu.co)"

date: ""       # dejamos esto vacío y la fecha la pone LaTeX
output: html_document
editor_options: 
  markdown: 
    wrap: 72
ormat:
  pdf:
    documentclass: article
    fontsize: 11pt
    geometry: "margin=2.5cm"
    linestretch: 1.1
    indent: true

header-includes: |
  \setlength{\parskip}{0em}          % sin espacio extra entre párrafos
  \setlength{\parindent}{1.5em}      % con sangría
  \date{1 de noviembre de 2025}      % fecha tal cual quieres que salga
---

# Descripción de la base de datos ENPOL 2021

Para este proyecto utilizo la Encuesta Nacional de la Población Privada
de la Libertad (ENPOL) correspondiente al año 2021, la cual es una
operación estadística desarrollada por el Instituto Nacional de
Estadística y Geografía (INEGI) de México. Esta encuesta constituye una
de las fuentes más completas y actualizadas sobre las condiciones de
vida, características sociodemográficas y situación jurídica de las
personas privadas de la libertad en el país.

La ENPOL tiene como objetivo generar información confiable sobre
diferentes aspectos del internamiento, tales como el acceso a servicios
básicos, el nivel de hacinamiento, los antecedentes familiares y
laborales de la población reclusa, y la experiencia que las personas han
tenido dentro del sistema penitenciario. Esta encuesta se ha aplicado en
dos ocasiones, en 2016 y 2021; para este trabajo utilizo los datos más
recientes.

En general, la ENPOL incluye una amplia variedad de temas: desde
variables sociodemográficas hasta condiciones específicas del
internamiento, percepciones de seguridad, reincidencia, vínculos
familiares y características del centro penitenciario. En este proyecto
se trabajó con un subconjunto de estas variables, las cuales fueron:

```{r include=FALSE}
# Instalar paquetes si es necesario
if (!require("FactoMineR")) install.packages("FactoMineR")
if (!require("Factoshiny")) install.packages("Factoshiny")

#Manejo de datos
library(tidyverse)
library(readr)
library(dplyr)
library(readxl)
library(haven)
#Gráficos
library(ggplot2)
library(plotly)
library(GGally)
#ACP
library(ade4)
library(FactoClass)
library(FactoMineR)
library(factoextra)
library(Factoshiny)

#Ajustes de tema del documento y graficos
library(scales)
library(DT)
library(gt)
library(RColorBrewer)
theme_set(theme_minimal(base_size = 24, base_family = "Atkinson Hyperlegible"))
library(skimr)
library(ggplot2)
library(patchwork)
library(corrplot)
library(knitr)
# Cargar los archivos de datos
load("Base de datos_filtrada.RData")

```

```{r echo=FALSE, fig.height=10, fig.width=10, warning=FALSE, paged.print=TRUE}
diccionario <- tibble::tribble(
  ~variable, ~definicion, ~tipo,
  "id_persona", "Identificador único del participante", "Categórica (ID)",
  "edad", "Años cumplidos al momento de la encuesta", "Cuantitativa",
  "estado_civil", "Estado civil recodificado en 4 categorías", "Categórica",
  "escolaridad", "Nivel educativo agrupado en 4 niveles", "Categórica ordinal",
  "tiene_hijos", "Indica si el participante tiene hijos", "Dummy",
  "numero_hijos", "Número total de hijos", "Cuantitativa",
  "mantiene_alguien", "Mantenía económicamente a alguien antes de la detención", "Dummy",
  "personas_celda", "Número de personas con quienes comparte celda", "Cuantitativa",
  "comida_dia", "Número de comidas proporcionadas al día", "Cuantitativa",
  "horas_celda", "Horas que pasa en la celda durante un día", "Cuantitativa",
  "seguridad_celda", "Percepción de seguridad en la celda", "Dummy",
  "antes_recluido", "Ha sido recluido previamente", "Dummy",
  "veces_recluido", "Número total de reclusiones previas", "Cuantitativa",
  "vivio_con_madr", "Vivió con su madre antes de los 15 años", "Dummy",
  "vivio_con_padr", "Vivió con su padre antes de los 15 años", "Dummy",
  "mujer", "Dummy: 1 si es mujer", "Dummy",
  "detencion_varo", "Dummy: 1 si el centro es varonil", "Dummy",
  "detencion_fem", "Dummy: 1 si el centro es femenil", "Dummy"
)

gt(diccionario) %>%
  tab_header(title = "Diccionario de Variables del Estudio")

```

La base de datos original cuenta con 61.449 personas entrevistadas, a
quienes se les aplicó un cuestionario de 1.252 variables. Dado el
volumen y la naturaleza de la información (mayoritariamente dicotómica y
con opciones adicionales como “no sé” o “no respondo”) es ideal aplicar
un Análisis de Componentes Principales (ACP) que permita sintetizar y
describir mejor la estructura subyacente de los datos.

Sin embargo, para los fines de este proyecto (y dado a limitaciones
computacionales) se seleccionó un subconjunto de 17 variables
relacionadas con características sociodemográficas, condiciones de
internamiento y antecedentes personales. Durante la revisión inicial se
identificó que varias preguntas no eran respondidas por motivos lógicos.
Por ejemplo, quienes indicaban no tener hijos dejaban en blanco el
número de hijos; en estos casos se imputó el valor 0, coherente con el
contexto.

Tras este ajuste, el volumen restante de datos faltantes resultó mínimo
en relación con el tamaño total de la muestra, por lo que se optó por
eliminar los registros con respuestas vacías o con las opciones “No
sabe/No responde”.

Además, dado que el ACP requiere trabajar exclusivamente con variables
cuantitativas, se transformaron en dummies todas las variables
dicotómicas, y la variable sobre el tipo de centro penitenciario
(femenil, varonil o mixto) se recodificó en dos variables dummy
adicionales.

Por lo tanto, el análisis se realizó sobre una base de 31.535 individuos
y 18 variables, donde una corresponde al identificador, dos son
categóricas transformadas en dummies y el resto son completamente
cuantitativas.

Pero antes de proceder con el ACP se hace una breve descripción y
análisis de los datos por histogramas y gráficos de barras, antes de
pasar a dummy las variables dicotomicas.

```{r echo=FALSE, fig.height=10, fig.width=10, warning=FALSE, paged.print=TRUE}
vars_cont <- c(
  "edad",
  "numero_hijos",
  "personas_celda",
  "comida_dia",
  "horas_celda",
  "veces_recluido"
)

graficos <- lapply(vars_cont, function(v) {

  df <- datos_filtrados %>%
    filter(!is.na(.data[[v]])) %>%
    mutate(valor = as.integer(.data[[v]])) %>%  # asegura valores enteros
    count(valor)

  ggplot(df, aes(x = valor, y = n)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    labs(
      title = paste("Distribucion de", v),
      x = v,
      y = "Frecuencia"
    ) +
    theme_minimal(base_size = 11) +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1)
    )
})

wrap_plots(graficos, ncol = 2)
```

Al mirar los gráficos pareciera que la edad se concentra en adultos
jóvenes, mientras que variables como número de hijos y reclusiones
previas muestran una fuerte acumulación en cero, lo que indica tanto la
juventud de la muestra como la prevalencia de personas internas por
primera vez. En contraste, variables asociadas a las condiciones de
internamiento (como personas en la celda, comidas diarias y horas dentro
de la celda) exhiben mayor variabilidad, incluyendo casos extremos de
hacinamiento o encierro prolongado.

En conjunto, estas distribuciones permiten identificar desigualdades en
las condiciones de vida dentro de los centros penitenciarios y
evidencian la heterogeneidad de experiencias entre los entrevistados

```{r echo=FALSE, fig.height=10, fig.width=10, warning=FALSE, paged.print=TRUE}
# Variables categóricas de tu base
vars_cat <- c(
  "sexo",
  "estado_civil",
  "escolaridad",
  "tiene_hijos",
  "mantiene_alguien",
  "estado_detencion",
  "seguridad_celda",
  "antes_recluido",
  "vivio_con_madr",
  "vivio_con_padr"
)

graficos_cat <- lapply(vars_cat, function(v) {

  df <- datos_filtrados %>%
    filter(!is.na(.data[[v]])) %>%
    count(.data[[v]]) %>%
    arrange(desc(n))

  colnames(df) <- c("categoria", "frecuencia")

  ggplot(df, aes(x = reorder(categoria, frecuencia), y = frecuencia)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    coord_flip() +  # ← gráfico horizontal
    labs(
      title = paste("Distribución de", v),
      x = "Categoría",
      y = "Frecuencia"
    ) +
    theme_minimal(base_size = 11)
})

wrap_plots(graficos_cat, ncol = 2)

```

Se observa que predominan los hombres en las carceles de México, así
como personas solteras y con niveles educativos que no superan la
secundaria. Más de la mitad declara tener hijos y una proporción
importante mantenía económicamente a alguien antes de su detención, lo
que evidencia que el encarcelamiento afecta no solo al individuo, sino
también a su entorno familiar. Estas condiciones sociales y educativas
reflejan patrones de vulnerabilidad que suelen documentarse en población
penitenciaria.

En términos institucionales, la mayor parte de los entrevistados se
encuentra en centros varoniles. La mayoría no ha enfrentado reclusiones
previas, y los antecedentes familiares (haber vivido con madre o padre
durante la infancia) muestran niveles relativamente iguales.

```{r echo=FALSE, fig.height=11, fig.width=10, message=FALSE, warning=FALSE}
# Seleccionar solo variables continuas
vars_cont <- datos_con_dummies %>% 
  select(-c(id_persona, estado_civil, escolaridad)
  )

# Matriz de correlación
mat_cor <- cor(vars_cont, use = "pairwise.complete.obs")

# Paleta estética
paleta <- colorRampPalette(c(
  "#313695", "#4575B4", "#74ADD1", "#ABD9E9",
  "#E0F3F8", "#FFFFBF", "#FEE090", "#FDAE61",
  "#F46D43", "#D73027", "#A50026"
))

# Corrplot bonito
corrplot(
  mat_cor,
  method = "color",
  col = paleta(200),
  type = "upper",        # solo triángulo superior (más limpio)
  order = "hclust",      # agrupa variables por similitud
  addCoef.col = "black", # añade los coeficientes
  tl.col = "black",      # color de las etiquetas
  tl.srt = 45,           # giro de etiquetas
  number.cex = 0.8,      # tamaño de números
  diag = FALSE           # oculta diagonal (no aporta)
)
```

Al análizar la matriz de correlaciones permitió identificar asociaciones
relevantes entre las variables antes de aplicar el ACP. Destaca la
relación positiva entre tener hijos y mantener económicamente a alguien,
lo que parece coherente. Asimismo, se observan correlaciones moderadas
entre variables vinculadas al tipo de centro y ciertos servicios, como
la relación entre mujer y comidas diarias, lo que sugiere posibles
diferencias institucionales en la provisión de recursos. Las
percepciones de seguridad también muestran patrones diferenciados: los
internos de centros varoniles tienden a reportar menor seguridad en
comparación con otros centros.

Por otra parte, las variables asociadas a antecedentes penales, como
haber sido recluido previamente y número de reclusiones, presentan
correlaciones esperables, mientras que factores del entorno familiar en
la niñes muestran asociaciones débiles con el resto de los indicadores.

# Análisis de Componentes Principales (ACP)

Se aplicó un ACP sobre las variables cuantitativas estandarizadas, en
concreto se generaron 15 componentes, de los cuales los seis primeros
explican el 63.43 % de la varianza total. Se seleccionan estos
inicialmente por la regla de los autovalores mayores a 1 y porque en
conjunto explican una proporción sustancial de la varianza.

```{r}

res.pca<-FactoMineR:: PCA(vars_cont, ncp=20, scale.unit = TRUE, graph = FALSE)
acp <- dudi.pca(vars_cont, scannf = FALSE, nf = 15) 

# El parámetro nf indica cuantos ejes voy a conservar
valp <- t(inertia(acp)$tot.inertia) # valores propios
#kable(valp, digits = 3)
```

en donde se sabe que

-   Varianza de la componente $\alpha$:\
    $$
    \text{var}(z_\alpha) = \lambda_\alpha
    $$
-   Porcentaje de varianza explicada por la componente $\alpha$:\
    $$
    \tau_\alpha = \frac{\lambda_\alpha}{\sum_{\alpha=1}^p \lambda_\alpha}
    $$
-   Porcentaje acumulado de varianza explicada por las primeras
    $q$componentes:\
    $$
    \tau_q = \frac{\sum_{\alpha=1}^q \lambda_\alpha}{\sum_{\alpha=1}^p \lambda_\alpha}
    $$

```{r echo=FALSE, fig.height=4, fig.width=10, message=FALSE, warning=FALSE}
# Extraer los valores propios y calcular los porcentajes
eigenvalues <- valp[1, ]  # Fila "inertia"
cumulative_variance <- valp[2, ]  # Fila "cum"
total_variance <- cumulative_variance[length(cumulative_variance)] # Total de varianza explicada
percentage_variance <- (eigenvalues / total_variance) * 100

# --- GRÁFICO 1: Varianza explicada por los ejes ---
# Crear un data frame para el gráfico
df_ejes <- data.frame(
  Eje = 1:length(eigenvalues),
  Porcentaje = percentage_variance,
  Etiqueta = paste0(round(percentage_variance, 1), "%")
)

# Crear el gráfico de barras con línea
grafico_varianza <- ggplot(df_ejes, aes(x = Eje, y = Porcentaje)) +
  geom_bar(stat = "identity", fill = "steelblue", color = "black", width = 0.7) +
  geom_line(aes(y = Porcentaje), color = "black", size = 1) +
  geom_point(aes(y = Porcentaje), color = "black", size = 3) +
  geom_text(aes(label = Etiqueta), vjust = -0.5, hjust = 0.5, size = 3.5) +
  labs(
    title = "Varianza explicada por los ejes",
    x = "Eje",
    y = "Porcentaje de varianza explicada"
  ) +
  scale_x_continuous(breaks = 1:length(eigenvalues)) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.minor.y = element_blank()
  )


# --- GRÁFICO 2: Valores propios ---

# Crear un data frame para el gráfico de valores propios
df_valprop <- data.frame(
  Eje = 1:length(eigenvalues),
  ValorPropio = eigenvalues
)

# Crear el gráfico de barras
grafico_valprop <- ggplot(df_valprop, aes(x = Eje, y = ValorPropio)) +
  geom_bar(stat = "identity", fill = "steelblue", color = "black", width = 0.7) +
  labs(
    title = "Valores propios",
    x = "Eje",
    y = "Valor Propio"
  ) +
  scale_x_continuous(breaks = 1:length(eigenvalues)) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.minor.y = element_blank()
  ) +
  # Línea horizontal en y=1
  geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 1) +
  # Área sombreada para valores > 1
  annotate("rect",
           xmin = -Inf, xmax = Inf,
           ymin = 0.8, ymax = Inf,
           fill = "pink", alpha = 0.3)


wrap_plots(c(grafico_valprop, grafico_varianza), ncol = 2)
```

------------------------------------------------------------------------

## Contribuciones de las Variables a la Varianza del Factor

An análizar las principales contribuciones de cada factor se encontron
los siguientes interpretaciones:

-   Eje 1: Género y tipo de centro. Diferencia principalmente entre
    mujeres y hombres, así como entre centros femeniles y varoniles.
-   Eje 2: Responsabilidad familiar. Refleja la presencia de hijos y la
    carga económica previa, indicando vínculos familiares fuertes antes
    de la detención.
-   Eje 3: Experiencia penitenciaria previa. Resume la reincidencia y la
    trayectoria en el sistema, junto con algunos antecedentes familiares
    tempranos.
-   Eje 4: Vínculos familiares en la infancia. Captura la estabilidad
    familiar en los primeros años de vida, con una ligera asociación con
    la edad.
-   Eje 5: Condiciones materiales del encierro. Representa el
    hacinamiento, la seguridad en la celda y condiciones más frecuentes
    en centros varoniles.
-   Eje 6: Edad y dinámica diaria. Combina madurez, responsabilidades
    previas y el tiempo que los internos pasan encerrados.

$$
\text{Contribución}(Y_j, z_\alpha) = \frac{u_{j\alpha}^2 \cdot \lambda_\alpha}{\lambda_\alpha} = u_{j\alpha}^2
$$ O, en forma de porcentaje: $$
\text{Contribución}(\%) = \frac{u_{j\alpha}^2}{\sum_{j=1}^p u_{j\alpha}^2} \times 100
$$

Interpretación: - Indica cuánto contribuye la variable $Y_j$a la
formación de la componente $z_\alpha$. - Valores altos: La variable es
importante para definir esa componente.

```{r echo=FALSE, fig.height=10, fig.width=11, message=FALSE, warning=FALSE}
n_ejes <- 6

# Preparar una lista para almacenar los gráficos de cada eje.
graficos_contribucion <- list()

for (eje in 1:n_ejes) {
  contribuciones <- res.pca$var$contrib[, eje]
  
  # Ordenar las variables por su contribución (de mayor a menor)
  contribuciones_ordenadas <- sort(contribuciones, decreasing = TRUE)
  
  # Seleccionar las 10 variables con mayor contribución (ajusta este número si lo deseas)
  top_vars <- names(contribuciones_ordenadas)[1:10]
  top_contribs <- contribuciones_ordenadas[1:10]
  
  # Crear un data frame para el gráfico
  df_contrib <- data.frame(
    Variable = factor(top_vars, levels = top_vars), # Para mantener el orden en el gráfico
    Contribucion = top_contribs
  )
  
  # Crear el gráfico de barras
  grafico_eje <- ggplot(df_contrib, aes(x = Variable, y = Contribucion)) +
    geom_bar(stat = "identity", fill = "steelblue", color = "black", width = 0.7) +
    labs(
      title = paste("Contribución de variables al Eje", eje),
      x = "Variable",
      y = "Contribución (%)"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5),
      panel.grid.major.y = element_line(color = "grey80"),
      panel.grid.minor.y = element_blank(),
      axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, size = 8) # Rotar etiquetas para mejor lectura
    ) +
    # Añadir texto con el valor de la contribución encima de cada barra
    geom_text(aes(label = round(Contribucion, 1)), vjust = -0.3, size = 3)
  
  # Guardar el gráfico en la lista
  graficos_contribucion[[eje]] <- grafico_eje
  
}
wrap_plots(graficos_contribucion, ncol = n_ejes/3)
```

------------------------------------------------------------------------

## Calidad de representación ($\cos^2$)

Recordando que se calcula como:

$$
\cos^2(\theta_{j,\alpha}) = \lambda_\alpha \cdot u_{j\alpha}^2
$$

```{r echo=FALSE, fig.height=10, fig.width=11, message=FALSE, warning=FALSE}
# Número de ejes a graficar
n_ejes <- 6

# Lista para almacenar gráficos
graficos_cos2 <- list()

for (eje in 1:n_ejes) {
  
  # Extraer resultados de variables del PCA
  var_res <- factoextra::get_pca_var(res.pca)
  
  # Obtener cos² de las variables para el eje actual
  cos2_vals <- var_res$cos2[, eje]
  
  # Ordenar descendentemente
  cos2_ordenado <- sort(cos2_vals, decreasing = TRUE)
  
  # Seleccionar las 10 variables con mayor cos²
  top_vars <- names(cos2_ordenado)[1:10]
  top_cos2 <- cos2_ordenado[1:10]
  
  # Data frame
  df_cos2 <- data.frame(
    Variable = factor(top_vars, levels = top_vars),
    Cos2 = top_cos2
  )
  
  
  # Gráfico
  g <- ggplot(df_cos2, aes(x = Variable, y = Cos2)) +
    geom_bar(stat = "identity", fill = "steelblue", color = "black", width = 0.7) +
    geom_text(aes(label = round(Cos2, 3)), vjust = -0.4, size = 3) +
    labs(
      title = paste("Calidad de representación (cos²) – Eje", eje),
      x = "Variable",
      y = "Cos²"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5),
      axis.text.x = element_text(angle = 45, hjust = 1, size = 8)
    )
  
  graficos_cos2[[eje]] <- g
}
wrap_plots(graficos_cos2, ncol = n_ejes/3)

```

Como complemento, el análisis de cos² confirma que las variables
centrales de cada eje están bien representadas por los componentes
retenidos. En cada dimensión aparecen una o dos variables con cos² altos
(mujer y detención femenina en el Eje 1; hijos y número de hijos en el
Eje 2; reincidencia en el Eje 3; convivencia con madre y padre en el Eje
4; hacinamiento en el Eje 5; edad en el Eje 6) lo que respalda que cada
componente captura una dimensión clara y consistente. Ademas se observa
que las variables están siendo bien representadas por un factor y no por
varios a la vez

------------------------------------------------------------------------

## Coordenadas de los Objetos (Individuos)

$$
z_{i\alpha} = \sum_{j=1}^p u_{j\alpha} \cdot y_{ij}
$$ o, en notación matricial: $$
z_\alpha = Y \cdot u_\alpha
$$

Interpretación: - Representa la posición del objeto $i$en la componente
$\alpha$. - Se usan para graficar los objetos en los planos factoriales.

```{r echo=FALSE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE}
# ---------- GRÁFICO 1: VARIABLES ----------
g1 <- plot.PCA(
  res.pca,
  choix = "var",
  select = "cos2 0.2",
  unselect = 0,
  habillage = 'contrib',  
  label = "all"
) + 
  ggtitle("Mapa de Variables (cos² ≥ 0.20)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

# ---------- GRÁFICO 2: INDIVIDUOS ----------
g2 <- plot.PCA(
  res.pca,
  choix = "ind",
  invisible = c("ind.sup"),
  select = "cos2 0.7",
  habillage = 'contrib', 
  label = "none"
) +
  ggtitle("Mapa de Individuos (cos² ≥ 0.70)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

g_final <- g1 + g2 +
  plot_annotation(
    title = "Análisis de Componentes Principales (ACP)",
    theme = theme(
      plot.title = element_text(size = 18, face = "bold", hjust = 0.5)
    )
  )
g_final

```

El mapa factorial refuerza la interpretación previa: en el plano de los
dos primeros ejes, las variables con mejor representación se organizan
de forma coherente con las dimensiones ya identificadas. El primer eje
separa a hombres y mujeres según el tipo de centro, mientras que el
segundo recoge la responsabilidad familiar mediante variables como tener
hijos, número de hijos o sostener a alguien. La disposición ortogonal de
ambos conjuntos confirma que género y vínculos familiares son
dimensiones independientes.

La proyección de los individuos (destacando a quienes tienen más del 70%
de representación en el plano) muestra una diversidad amplia sin grupos
distinguibles, pero con tendencias claras: mujeres con cargas familiares
tienden a ubicarse hacia el cuadrante superior derecho, mientras que
hombres sin dependientes se concentran hacia el lado opuesto.

```{r echo=FALSE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE}
# ---------- GRÁFICO 1: VARIABLES ----------
g1 <- plot.PCA(
  res.pca,
  choix = "var",
  axes=c(2,3),
  select = "cos2 0.2",
  unselect = 0,
  habillage = 'contrib',  
  label = "all"
) + 
  ggtitle("Mapa de Variables (cos² ≥ 0.20)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

# ---------- GRÁFICO 2: INDIVIDUOS ----------
g2 <- plot.PCA(
  res.pca,
  choix = "ind",
  axes=c(2,3),
  invisible = c("ind.sup"),
  select = "cos2 0.7",
  habillage = 'contrib', 
  label = "none"
) +
  ggtitle("Mapa de Individuos (cos² ≥ 0.70)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

g_final <- g1 + g2 +
  plot_annotation(
    title = "Análisis de Componentes Principales (ACP)",
    theme = theme(
      plot.title = element_text(size = 18, face = "bold", hjust = 0.5)
    )
  )
g_final

```

El contraste entre los ejes 2 y 3 aclara que la responsabilidad familiar
y la experiencia penitenciaria previa son dimensiones distintas dentro
del perfil de los internos. Las variables familiares se mantienen
claramente asociadas al Eje 2, mientras que la reincidencia carga de
forma dominante en el Eje 3, confirmando que tener hijos o sostener a
alguien no implica haber pasado antes por prisión.

```{r echo=FALSE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE}
# ---------- GRÁFICO 1: VARIABLES ----------
g1 <- plot.PCA(
  res.pca,
  choix = "var",
  axes=c(3,4),
  select = "cos2 0.2",
  unselect = 0,
  habillage = 'contrib',  
  label = "all"
) + 
  ggtitle("Mapa de Variables (cos² ≥ 0.20)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

# ---------- GRÁFICO 2: INDIVIDUOS ----------
g2 <- plot.PCA(
  res.pca,
  choix = "ind",
  axes=c(3,4),
  invisible = c("ind.sup"),
  select = "cos2 0.7",
  habillage = 'contrib', 
  label = "none"
) +
  ggtitle("Mapa de Individuos (cos² ≥ 0.70)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

g_final <- g1 + g2 +
  plot_annotation(
    title = "Análisis de Componentes Principales (ACP)",
    theme = theme(
      plot.title = element_text(size = 18, face = "bold", hjust = 0.5)
    )
  )
g_final

```

```{r echo=FALSE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE}
# ---------- GRÁFICO 1: VARIABLES ----------
g1 <- plot.PCA(
  res.pca,
  choix = "var",
  axes=c(5,6),
  select = "cos2 0.2",
  unselect = 0,
  habillage = 'contrib',  
  label = "all"
) + 
  ggtitle("Mapa de Variables (cos² ≥ 0.20)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

# ---------- GRÁFICO 2: INDIVIDUOS ----------
g2 <- plot.PCA(
  res.pca,
  choix = "ind",
  axes=c(5,6),
  invisible = c("ind.sup"),
  select = "cos2 0.7",
  habillage = 'contrib', 
  label = "none"
) +
  ggtitle("Mapa de Individuos (cos² ≥ 0.70)") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank()
  )

g_final <- g1 + g2 +
  plot_annotation(
    title = "Análisis de Componentes Principales (ACP)",
    theme = theme(
      plot.title = element_text(size = 18, face = "bold", hjust = 0.5)
    )
  )
g_final

```

A partir de los anteriores birplots y análisis se pueden interpretar los
seis factores seleccionados de la siguiente manera:

1.  **Factor 1**: separa a mujeres y hombres según el tipo de centro
    penitenciario.
2.  **Factor 2**: concentra variables sobre hijos y dependientes
    económicos.
3.  **Factor 3**: recoge el historial de detenciones previas y número de
    reclusiones.
4.  **Factor 4**: asociado a haber convivido con padre o madre durante
    la infancia.
5.  **Factor 5**: dominado por el hacinamiento y la percepción de
    seguridad interna.
6.  **Factor 6**: combina edad con horas de encierro y hábitos diarios.

En conjunto, cada factor interpreta independientepente un aspecto de las
personas privadas de la libertad en mexico y podemos quedarnos con estas
6 variables para posteriores estudios en vez de con las 17 variables
iniciales.

------------------------------------------------------------------------

## Variables Suplementarios

-   Proyección de variable suplementaria: $$
    Y^+ \cdot u_\alpha
    $$

Interpretación: - Permiten incluir información adicional sin afectar el
cálculo de las componentes. - Cercanía a variables/objetos activos:
Indica similitud o asociación.

```{r echo=FALSE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE}
res.PCA<-PCA(datos_con_dummies %>% select(-id_persona),quali.sup=c(2,3),graph=FALSE,  scale.unit = TRUE)

# ---- Variables suplementarias ----
plot.PCA(
  res.PCA,
  invisible = c("ind", "ind.sup"),
  col.quali = "#0077FF",
  label =c('quali')
) +
  ggtitle("Variables Cualitativas Suplementarias") +
  theme_minimal(base_size = 13)


```

Aunque las variables categóricas solo pueden incorporarse formalmente al
ACP al convertirlas en dummies, existe otra alternativa: proyectarlas a
posteriori sobre los planos factoriales. Eso fue justamente lo que
hicimos con escolaridad y estado civil.

Al observar su posición en los planos, se sugiere que:

-   Dentro de la población privada de la libertad, podría haber más
    mujeres que hombres en condición de viudez y con niveles educativos
    superiores a la secundaria.

-   Estas mismas personas parecen no tener responsabilidades de
    manutención, ya sea porque no tienen hijos menores o no sostienen
    económicamente a alguien.

-   En contraste, quienes tienen hijos menores y asumen su manutención
    tienden a ubicarse cerca de las categorías separado/a, divorciado/a
    o en unión libre.

 En conjunto, nos presentan diferentes situaciones que en conjuto y en este contexto nos da indicios de como es la población penitenciaria en México.

``` r
# Crear muestra del 10% 
muestra_10pct <- datos_con_dummies %>% 
  sample_frac(0.10)
nrow(muestra_10pct) # 3 154
# 1. ACP estándar
result <- PCAshiny(muestra_10pct %>% select(-id_persona))
```
